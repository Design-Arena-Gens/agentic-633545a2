"use client";
import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

type Lang = 'en' | 'hi' | 'ml' | 'ta' | 'kn' | 'te' | 'bn' | 'ar';
const SupportedLanguages: Lang[] = ['en','hi','ml','ta','kn','te','bn','ar'];

const UI_STRINGS: Record<string, Partial<Record<Lang, string>>> = {
  title: {
    en: 'Bhagavad Gita: Essence & Everyday Wisdom',
    hi: '?????????: ??? ?? ????? ?????',
    ml: '????? ???: ???? & ?????????',
    ta: '?????????: ??????? ??????????',
    kn: '?????????: ??? ????? ??????? ?????',
    te: '????????: ???? & ?????????',
    bn: '?????????: ??? ? ???????? ?????',
    ar: '?????????? ????: ?????? ??????? ???????',
  },
  subtitle: {
    en: 'Understand the Gita beyond religion ? brief insights, real-life scenarios, serene audio.',
    hi: '???? ?? ??? ???? ?? ????? ? ????????? ???????????, ???????? ???? ????????, ???? ??????',
    ml: '?????? ???????? ????? ????????????? ? ???????????? ?????????, ???????? ????? ??????????, ???????? ?????.',
    ta: '???????? ?????? ?????? ???????? ??????????? ? ?????????? ?????????, ?????????? ????????, ???????? ???.',
    kn: '???????? ????? ????? ? ????????? ??????, ???? ?????????, ????? ?????.',
    te: '??????? ???? ????? ????? ????????? ? ????????? ????????, ???? ?????????, ??????? ?????.',
    bn: '?????? ????? ???? ????? ? ????????? ????????????, ?????? ??????, ????? ????',
    ar: '???? ?????? ???? ????? ? ????? ?????? ?????????? ??????? ??? ????.',
  },
  start_journey: {
    en: 'Start your journey', hi: '???? ?????? ???? ????', ml: '????????? ????? ??????????', ta: '?????? ??????? ????????????', kn: '????? ?????? ??????????', te: '?? ??????????? ?????????????', bn: '????? ?????? ???? ????', ar: '???? ?????'
  },
  chapters: { en: 'Chapters', hi: '??????', ml: '??????????', ta: '?????????????', kn: '?????????', te: '?????????', bn: '???????????', ar: '??????' },
  soundscape: { en: 'Soundscape', hi: '????? ????????', ml: '????????', ta: '??? ?????', kn: '????? ??????', te: '???? ??????', bn: '???????????', ar: '??????? ???????' },
  tanpura_desc: {
    en: 'A gentle tanpura drone to accompany your reading. Toggle on/off below.',
    hi: '????? ??? ??? ???? ?? ??? ???? ??????? ?????? ???? ????/??? ?????',
    ml: '??????????????? ????????? ???????? ??????? ????. ???? ??/??? ???????.',
    ta: '???????????? ?????? ????????? ??????? ???. ???? ???/???? ???????????.',
    kn: '?????????? ???????? ???? ?????? ???. ????? ???/??? ????.',
    te: '??????? ???? ???? ??????? ????. ?????? ???/??? ??????.',
    bn: '????? ???? ???? ???????? ???? ???? ????/???? ?????',
    ar: '????? ???? ????? ??????. ???? ???????/??????? ?????.'
  },
  previous: { en: 'Previous', hi: '?????', ml: '?????????', ta: '???????', kn: '????????', te: '???????', bn: '??????????', ar: '??????' },
  next: { en: 'Next', hi: '????', ml: '????????', ta: '????????', kn: '????????', te: '??????', bn: '???????', ar: '??????' },
  listen: { en: 'Listen', hi: '?????', ml: '????????', ta: '?????', kn: '?????', te: '??????', bn: '?????', ar: '?????' },
  pause: { en: 'Pause', hi: '?????', ml: '??????', ta: '????????????', kn: '?????', te: '??????', bn: '?????', ar: '????? ????' },
  stop: { en: 'Stop', hi: '?????', ml: '????????', ta: '????????', kn: '????????', te: '?????', bn: '?????', ar: '????' },
  language: { en: 'Language', hi: '????', ml: '???', ta: '????', kn: '????', te: '???', bn: '????', ar: '?????' },
};

const LanguageContext = createContext<{ lang: Lang; setLang: (l: Lang) => void }>({ lang: 'en', setLang: () => {} });

export function LanguageProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLangState] = useState<Lang>('en');

  useEffect(() => {
    const saved = typeof window !== 'undefined' ? (localStorage.getItem('lang') as Lang | null) : null;
    if (saved && SupportedLanguages.includes(saved)) setLangState(saved);
  }, []);

  const setLang = (l: Lang) => {
    setLangState(l);
    if (typeof window !== 'undefined') localStorage.setItem('lang', l);
  };

  const value = useMemo(() => ({ lang, setLang }), [lang]);

  return (
    <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>
  );
}

export function useLanguage() { return useContext(LanguageContext); }

export function useI18n() {
  const { lang } = useLanguage();
  return (key: keyof typeof UI_STRINGS, fallback?: string) => UI_STRINGS[key][lang] ?? fallback ?? String(key);
}

export function LanguageSelector() {
  const { lang, setLang } = useLanguage();
  return (
    <div className="inline-flex items-center gap-2">
      <span className="text-sm text-white/70">{useI18n()('language', 'Language')}:</span>
      <select
        aria-label="Select language"
        className="bg-white/10 rounded-lg px-2 py-1"
        value={lang}
        onChange={(e) => setLang(e.target.value as any)}
      >
        <option value="en">English</option>
        <option value="hi">??????</option>
        <option value="ml">??????</option>
        <option value="ta">?????</option>
        <option value="kn">?????</option>
        <option value="te">??????</option>
        <option value="bn">?????</option>
        <option value="ar">???????</option>
      </select>
    </div>
  );
}

export type { Lang };
